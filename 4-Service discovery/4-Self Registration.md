Паттерн "Self Registration" описывает подход, при котором экземпляры сервисов самостоятельно регистрируются в реестре сервисов при запуске и отменяют регистрацию при завершении работы.

## Контекст

При использовании паттернов клиентской или серверной службы обнаружения экземпляры сервисов должны быть зарегистрированы в реестре на старте, чтобы их можно было обнаружить, и отменить регистрацию при завершении работы.

## Проблема

Как экземпляры сервисов могут регистрироваться и отменять регистрацию в реестре сервисов?

## Силы

- Экземпляры сервисов должны регистрироваться в реестре на старте и отменять регистрацию при завершении работы.
- Экземпляры, которые аварийно завершают работу, должны быть автоматически исключены из реестра.
- Экземпляры, которые работают, но не могут обрабатывать запросы, также должны быть исключены.

## Решение

Экземпляр сервиса отвечает за свою регистрацию в реестре. При запуске он регистрирует свои данные (хост и IP-адрес) и становится доступным для обнаружения. Обычно клиент должен периодически обновлять свою регистрацию, чтобы реестр знал о его работоспособности. При завершении работы экземпляр отменяет свою регистрацию.Эта логика обычно реализуется с помощью **микросервисного шасси**.

## Примеры

Примером приложения с саморегистрацией является **Microservices Example**, написанное на Scala с использованием Spring Boot и Spring Cloud. Оно использует **Eureka Service Registry** как компонент Netflix OSS. Регистрация сервиса настраивается с помощью аннотации `@EnableEurekaClient` в конфигурационном классе Java:

```
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;

@SpringBootApplication
@EnableEurekaClient
public class EurekaClientApplication {
    public static void main(String[] args) {
        SpringApplication.run(EurekaClientApplication.class, args);
    }
}
```

Эта аннотация позволяет экземпляру сервиса зарегистрироваться в Eureka.

## Результирующий контекст

Преимущества паттерна саморегистрации включают:

- Экземпляр сервиса знает свое состояние и может реализовать более сложную модель состояния, например, STARTING или AVAILABLE.

Недостатки:

- Связывает сервис с реестром.
- Необходимо реализовывать логику регистрации сервиса для каждого языка программирования или фреймворка.
- Экземпляр, который работает, но не может обрабатывать запросы, часто не имеет возможности отменить свою регистрацию.

## Связанные паттерны

- **Service Registry** — важная часть обнаружения сервисов.
- **Client Side Discovery** — один из способов обнаружения экземпляра сервиса.
- **Server Side Discovery** — другой способ обнаружения.
- **Microservice Chassis** — реализация саморегистрации возлагается на фреймворк микросервисного шасси.
- **3rd Party Registration** — альтернативное решение для регистрации экземпляров.

Этот паттерн обеспечивает эффективное управление регистрацией сервисов, позволяя им самостоятельно управлять своим состоянием в реестре.

[Ссылка на источник](https://microservices.io/patterns/self-registration.html)