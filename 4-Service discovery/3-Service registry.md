Паттерн "Service Registry" описывает подход к организации обнаружения сервисов, обеспечивая клиентам и маршрутизаторам информацию о доступных экземплярах сервисов.

## Контекст

Клиенты сервиса используют либо клиентскую, либо серверную службу обнаружения для определения расположения экземпляров сервиса, к которым они могут отправлять запросы.

## Проблема

Как клиенты сервиса (в случае клиентской службы обнаружения) и/или маршрутизаторы (в случае серверной службы обнаружения) могут узнать о доступных экземплярах сервиса?

## Решение

Решение заключается в реализации **реестра сервисов** — базы данных, содержащей информацию о сервисах, их экземплярах и местоположениях. Экземпляры сервисов регистрируются в реестре при запуске и отменяются при завершении работы. Клиенты и маршрутизаторы запрашивают реестр для нахождения доступных экземпляров сервиса. Реестр может вызывать API проверки состояния экземпляра сервиса для подтверждения его работоспособности.

## Примеры

Примером приложения, использующего клиентскую службу обнаружения, является **Microservices Example**, написанное на Scala с использованием Spring Boot и Spring Cloud. Оно включает в себя реализацию **Eureka** как реестра сервисов.

```
@SpringBootApplication @EnableEurekaServer public class EurekaServer { public static void main(String[] args) { new SpringApplicationBuilder(EurekaServer.class).web(true).run(args); } }
```

Другие примеры технологий, используемых в качестве реестров сервисов, включают Kubernetes, Marathon и AWS ELB.

## Преимущества

- Клиенты и маршрутизаторы могут обнаруживать расположение экземпляров сервисов.

## Недостатки

- Реестр сервисов является дополнительным компонентом инфраструктуры, который необходимо настраивать и поддерживать. Он должен быть высокодоступен, так как сбой реестра приведет к устареванию кэшированных данных у клиентов.

## Регистрация экземпляров

Существует два варианта регистрации экземпляров сервисов:

- **Саморегистрация**: Экземпляры сервисов регистрируют себя.
- **Регистрация третьей стороной**: Третья сторона регистрирует экземпляры в реестре.

Клиенты реестра должны знать расположение его экземпляров, которые должны быть развернуты на фиксированных IP-адресах.

## Связанные паттерны

- Клиентская и серверная службы обнаружения создают необходимость в реестре сервисов.
- Паттерны саморегистрации и регистрации третьей стороной определяют способы регистрации экземпляров.
- API проверки состояния используется для подтверждения работоспособности экземпляров сервисов.

Этот паттерн позволяет эффективно управлять взаимодействием между клиентами и микросервисами, обеспечивая надежность и гибкость системы.

[Ссылка на источник](https://microservices.io/patterns/service-registry.html)