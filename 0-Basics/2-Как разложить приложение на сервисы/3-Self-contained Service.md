Паттерн **самодостаточного сервиса** (Self-Contained Service) описывает подход к проектированию микросервисов, который позволяет улучшить доступность и время отклика при обработке запросов. Рассмотрим основные моменты.

## Контекст

На примере приложения FTGO, которое занимается доставкой еды, клиент создает заказ с помощью HTTP-запроса `POST /orders`. Этот запрос обрабатывается несколькими сервисами: `Order Service`, `Restaurant Service`, `Consumer Service`, `Kitchen Service` и `Accounting Service`. Использование синхронного взаимодействия между этими сервисами может снизить доступность, так как сбой в работе любого из них приведет к ошибке при создании заказа.

## Проблема

Сложность заключается в том, как сервису эффективно взаимодействовать с другими сервисами при обработке синхронного запроса. Доступность операции зависит от доступности всех задействованных сервисов.

## Решение

Для повышения доступности можно проектировать сервисы так, чтобы они могли отвечать на запросы без ожидания ответов от других сервисов. Это можно реализовать несколькими способами:

- **Объединение функциональности**: Например, можно объединить `Order Service` и `Restaurant Service` в один модуль.
- **Использование паттернов CQRS и Saga**: Самодостаточный сервис использует паттерн CQRS для создания реплики данных, необходимых для выполнения операций, и паттерн Saga для асинхронного поддержания согласованности данных.

## Пример

В приложении FTGO `Order Service` является примером самодостаточного сервиса. Он использует реплику данных через CQRS для проверки и оценки заказа, а затем инициирует процесс через Saga для завершения создания заказа.

## Результаты

## Преимущества:

- Повышенная доступность и скорость ответа.

## Недостатки:

- Увеличение затрат и сложности при использовании CQRS.
- Сложность внедрения паттерна Saga.
- Менее понятный API при использовании Saga.
- Увеличение размера сервиса из-за реализации большей функциональности внутри него.

## Связанные паттерны

- **Микросервисная архитектура**: создает необходимость в этом паттерне.
- **Saga**: используется для асинхронного поддержания согласованности данных.
- **CQRS**: помогает поддерживать реплики данных, принадлежащих другим сервисам.

Этот подход позволяет создавать более устойчивые и отзывчивые системы в рамках микросервисной архитектуры.

[Ссылка на источник](https://microservices.io/patterns/decomposition/self-contained-service.html)